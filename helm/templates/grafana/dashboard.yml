{{- if and (index .Values "kube-prometheus-stack" "prometheus" "enabled") (index .Values "kube-prometheus-stack" "grafana" "enabled") }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: accounts-{{ include "app.name" . }}
  labels:
    grafana_dashboard: "1"
data:
  dashboard.json: |-
    {{ `{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations & Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":1,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"prometheus","uid":"prometheus"},"description":"","fieldConfig":{"defaults":{"mappings":[{"options":{"0":{"index":1,"text":"Above Threshold"},"1":{"index":0,"text":"Bellow Threshold"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":1}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":0},"id":2,"options":{"colorMode":"background","graphMode":"none","justifyMode":"center","orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"textMode":"value_and_name"},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"builder","exemplar":false,"expr":"statuses","format":"time_series","hide":false,"instant":false,"interval":"","legendFormat":"{{account_id}}","range":true,"refId":"A"}],"title":"Status","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]}},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":8},"id":1,"options":{"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"builder","expr":"balances","instant":false,"legendFormat":"{{account_id}}","range":true,"refId":"A"}],"title":"Wallet","type":"gauge"}],"refresh":"","schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[]},"time":{"from":"now-6h","to":"now"},"timepicker":{"refresh_intervals":["5m"]},"timezone":"","title":"Accounts","uid":"b13ac032-26ae-4550-8084-92d913142c81","version":4,"weekStart":""}` }}
{{- end }}
